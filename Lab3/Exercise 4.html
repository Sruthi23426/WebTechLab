<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Real-Time User Activity Monitor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f2f4f7;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background-color: #ffffff;
      padding: 20px;
      border-radius: 6px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }

    .monitor-area {
      padding: 15px;
      border: 1px solid #cccccc;
      margin-bottom: 20px;
      background-color: #fafafa;
    }

    .monitor-area input {
      padding: 6px;
      width: 300px;
      margin-bottom: 10px;
    }

    .log {
      max-height: 250px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 10px;
      background-color: #f9f9f9;
      font-size: 14px;
    }

    .warning {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }

    button {
      padding: 8px 14px;
      background-color: #3f51b5;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }

    button:hover {
      background-color: #303f9f;
    }
  </style>
</head>

<body>

<h1>Real-Time User Activity Monitor</h1>

<div class="container">

  <div class="monitor-area" id="monitorArea">
    <p>Interact with this area (click, type, focus):</p>
    <input type="text" placeholder="Type here to generate key events">
  </div>

  <h3>Activity Log</h3>
  <div class="log" id="activityLog"></div>

  <div class="warning" id="warningMsg"></div>

  <br>
  <button onclick="resetLog()">Reset Log</button>
  <button onclick="exportLog()">Export Log</button>

</div>

<script>
  /* 2. Store activities in an array of objects */
  let activityLog = [];
  let clickCount = 0;

  const logContainer = document.getElementById("activityLog");
  const warningMsg = document.getElementById("warningMsg");
  const monitorArea = document.getElementById("monitorArea");

  /* Utility function to add activity */
  function addActivity(type, target, phase) {
    const activity = {
      eventType: type,
      targetElement: target,
      eventPhase: phase,
      time: new Date().toLocaleTimeString()
    };

    activityLog.push(activity);
    displayLog();
  }

  /* 4. Dynamically display activity log using DOM */
  function displayLog() {
    logContainer.innerHTML = "";
    activityLog.forEach((act, index) => {
      const div = document.createElement("div");
      div.textContent =
        `${index + 1}. [${act.time}] ${act.eventType} on ${act.targetElement} (${act.eventPhase})`;
      logContainer.appendChild(div);
    });
  }

  /* 5. Threshold for suspicious activity */
  function checkSuspiciousActivity() {
    if (clickCount >= 10) {
      warningMsg.textContent = "Warning: Too many clicks detected!";
    }
  }

  /* 1 & 3. Track events using capturing and bubbling */

  // Click Event (Bubbling)
  document.addEventListener("click", function (e) {
    clickCount++;
    addActivity("Click", e.target.tagName, "Bubbling");
    checkSuspiciousActivity();
  }, false);

  // Click Event (Capturing)
  document.addEventListener("click", function (e) {
    addActivity("Click", e.target.tagName, "Capturing");
  }, true);

  // Key Press Event
  document.addEventListener("keydown", function (e) {
    addActivity("Key Press (" + e.key + ")", e.target.tagName, "Bubbling");
  });

  // Focus Event (Capturing)
  document.addEventListener("focus", function (e) {
    addActivity("Focus", e.target.tagName, "Capturing");
  }, true);

  /* 6. Reset activity log */
  function resetLog() {
    activityLog = [];
    clickCount = 0;
    logContainer.innerHTML = "";
    warningMsg.textContent = "";
  }

  /* 6. Export activity log as formatted text */
  function exportLog() {
    let exportText = "User Activity Log\n\n";
    activityLog.forEach((act, index) => {
      exportText +=
        `${index + 1}. ${act.time} | ${act.eventType} | ${act.targetElement} | ${act.eventPhase}\n`;
    });

    const blob = new Blob([exportText], { type: "text/plain" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "activity_log.txt";
    link.click();
  }
</script>

</body>
</html>
